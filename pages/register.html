<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuraLeap - Register</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">
    <link href="/css/dashboard.css" rel="stylesheet">
    <style>
        .register-container {
            background: linear-gradient(135deg, rgba(17, 24, 39, 0.8), rgba(9, 14, 29, 0.9)), 
                        url('/assets/neural-bg.jpg') no-repeat center center;
            background-size: cover;
        }
        .auth-options-container {
            position: relative;
            overflow: hidden;
        }
        .auth-option {
            transition: all 0.3s ease;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(75, 85, 99, 0.2);
            backdrop-filter: blur(10px);
        }
        .auth-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(6, 182, 212, 0.3);
        }
        .neon-input {
            border: 1px solid rgba(6, 182, 212, 0.3);
            box-shadow: 0 0 5px rgba(6, 182, 212, 0.2);
            transition: all 0.3s ease;
        }
        .neon-input:focus {
            border-color: rgba(6, 182, 212, 0.8);
            box-shadow: 0 0 10px rgba(6, 182, 212, 0.4);
        }
        .neon-flash {
            position: absolute;
            width: 2px;
            height: 100%;
            background-color: rgba(6, 182, 212, 0.6);
            filter: blur(5px);
            opacity: 0;
            animation: flash 5s infinite;
        }
        @keyframes flash {
            0% { opacity: 0; left: -10%; }
            5% { opacity: 0.8; }
            10% { opacity: 0; left: 110%; }
            100% { opacity: 0; left: 110%; }
        }
        
        /* New styles for better UI */
        .auth-tab {
            position: relative;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .auth-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: transparent;
            transition: all 0.3s ease;
        }
        .auth-tab.active {
            color: #06b6d4;
        }
        .auth-tab.active::after {
            background: #06b6d4;
        }
        
        .btn-gradient {
            background: linear-gradient(135deg, #0891b2, #0369a1);
            transition: all 0.3s ease;
        }
        .btn-gradient:hover {
            background: linear-gradient(135deg, #0891b2, #0284c7);
            transform: translateY(-1px);
        }
        
        /* Enhanced form styling */
        .form-input-wrapper {
            position: relative;
        }
        .form-input-wrapper .icon {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            left: 10px;
            color: #4b5563;
        }
        .form-input-icon {
            padding-left: 35px;
        }
    </style>
    
    <!-- Supabase JS Client - Ensure correct loading order -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/js/supabase-config.js"></script>
    <script src="/js/supabase-client.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/components.js"></script>
</head>
<body class="bg-dark-bg text-gray-200">
    <!-- Header (Navbar) -->
    <div id="header-container"></div>

    <!-- Registration Section -->
    <div class="register-container min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
        <div class="neon-flash"></div>
        <div class="max-w-md w-full space-y-8 relative z-10">
            <div class="text-center">
                <h2 class="mt-6 text-3xl font-extrabold text-white">
                    Join <span class="neon-text">Nerualeap</span> Today
                </h2>
                <p class="mt-2 text-sm text-gray-400">
                    Already have an account? <a href="/pages/login.html" class="font-medium text-cyan-400 hover:text-cyan-300">Sign in</a>
                </p>
            </div>
            
            <!-- Auth Options Tabs -->
            <div class="mt-8 flex justify-center space-x-4">
                <button id="email-tab" class="auth-tab px-4 py-2 text-cyan-400 border-b-2 border-cyan-400">Email</button>
                <button id="google-tab" class="auth-tab px-4 py-2 text-gray-400 hover:text-cyan-400">Google</button>
            </div>
            
            <div class="mt-6 auth-options-container">
                <!-- Email Registration Form -->
                <div id="email-register" class="auth-option card-bg rounded-xl p-8">
                    <form class="space-y-6" action="#" method="POST" id="register-form">
                        <div>
                            <label for="fullname" class="block text-sm font-medium text-gray-300">
                                Full Name
                            </label>
                            <div class="mt-1 form-input-wrapper">
                                <span class="icon">
                                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                </span>
                                <input id="fullname" name="fullname" type="text" autocomplete="name" required 
                                    class="neon-input form-input-icon appearance-none block w-full px-3 py-2 border border-gray-700 rounded-md shadow-sm placeholder-gray-500 bg-gray-800 text-white focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm">
                            </div>
                        </div>
                        
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-300">
                                Email address
                            </label>
                            <div class="mt-1 form-input-wrapper">
                                <span class="icon">
                                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                    </svg>
                                </span>
                                <input id="email" name="email" type="email" autocomplete="email" required 
                                    class="neon-input form-input-icon appearance-none block w-full px-3 py-2 border border-gray-700 rounded-md shadow-sm placeholder-gray-500 bg-gray-800 text-white focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm">
                            </div>
                        </div>

                        <div>
                            <label for="password" class="block text-sm font-medium text-gray-300">
                                Password
                            </label>
                            <div class="mt-1 relative form-input-wrapper">
                                <span class="icon">
                                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                    </svg>
                                </span>
                                <input id="password" name="password" type="password" autocomplete="new-password" required 
                                    class="neon-input form-input-icon appearance-none block w-full px-3 py-2 border border-gray-700 rounded-md shadow-sm placeholder-gray-500 bg-gray-800 text-white focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm">
                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                    <button type="button" id="toggle-password" class="text-gray-400 hover:text-gray-300 focus:outline-none"
                                        onclick="togglePasswordVisibility('password')">
                                        <svg class="h-5 w-5 password-eye-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <p class="mt-1 text-xs text-gray-500">Password must be at least 8 characters long</p>
                        </div>

                        <div>
                            <label for="confirm-password" class="block text-sm font-medium text-gray-300">
                                Confirm Password
                            </label>
                            <div class="mt-1 relative form-input-wrapper">
                                <span class="icon">
                                    <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                    </svg>
                                </span>
                                <input id="confirm-password" name="confirm-password" type="password" autocomplete="new-password" required 
                                    class="neon-input form-input-icon appearance-none block w-full px-3 py-2 border border-gray-700 rounded-md shadow-sm placeholder-gray-500 bg-gray-800 text-white focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm">
                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                    <button type="button" id="toggle-confirm-password" class="text-gray-400 hover:text-gray-300 focus:outline-none"
                                        onclick="togglePasswordVisibility('confirm-password')">
                                        <svg class="h-5 w-5 password-eye-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="flex items-center">
                            <input id="terms" name="terms" type="checkbox" required
                                class="h-4 w-4 text-cyan-600 focus:ring-cyan-500 border-gray-700 rounded bg-gray-800">
                            <label for="terms" class="ml-2 block text-sm text-gray-300">
                                I agree to the <a href="#" class="text-cyan-400 hover:text-cyan-300">Terms of Service</a> and <a href="#" class="text-cyan-400 hover:text-cyan-300">Privacy Policy</a>
                            </label>
                        </div>

                        <div>
                            <button type="submit" 
                                class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-dark-bg btn-gradient">
                                Create Account
                            </button>
                        </div>
                        
                        <div class="mt-4">
                            <button type="button" id="test-email-btn"
                                class="w-full flex justify-center py-2 px-4 border border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-300 bg-gray-800 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
                                Test Email Delivery
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Google Registration -->
                <div id="google-register" class="auth-option card-bg rounded-xl p-8 hidden">
                    <div class="text-center">
                        <div class="mb-6">
                            <svg class="h-16 w-16 mx-auto text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-medium text-white mb-4">Simplified Registration</h3>
                        <p class="mb-6 text-gray-400">Sign up using your Google account for a quick and secure registration process. No additional password required.</p>
                        <button id="google-signup-btn" type="button" onclick="signUpWithGoogle()" class="w-full flex justify-center items-center py-3 px-4 border border-gray-700 rounded-md shadow-sm bg-white text-base font-medium text-gray-800 hover:bg-gray-100 transition-colors">
                            <svg class="h-6 w-6 mr-3" viewBox="0 0 24 24" width="24" height="24" xmlns="http://www.w3.org/2000/svg">
                                <g transform="matrix(1, 0, 0, 1, 27.009001, -39.238998)">
                                    <path fill="#4285F4" d="M -3.264 51.509 C -3.264 50.719 -3.334 49.969 -3.454 49.239 L -14.754 49.239 L -14.754 53.749 L -8.284 53.749 C -8.574 55.229 -9.424 56.479 -10.684 57.329 L -10.684 60.329 L -6.824 60.329 C -4.564 58.239 -3.264 55.159 -3.264 51.509 Z"/>
                                    <path fill="#34A853" d="M -14.754 63.239 C -11.514 63.239 -8.804 62.159 -6.824 60.329 L -10.684 57.329 C -11.764 58.049 -13.134 58.489 -14.754 58.489 C -17.884 58.489 -20.534 56.379 -21.484 53.529 L -25.464 53.529 L -25.464 56.619 C -23.494 60.539 -19.444 63.239 -14.754 63.239 Z"/>
                                    <path fill="#FBBC05" d="M -21.484 53.529 C -21.734 52.809 -21.864 52.039 -21.864 51.239 C -21.864 50.439 -21.724 49.669 -21.484 48.949 L -21.484 45.859 L -25.464 45.859 C -26.284 47.479 -26.754 49.299 -26.754 51.239 C -26.754 53.179 -26.284 54.999 -25.464 56.619 L -21.484 53.529 Z"/>
                                    <path fill="#EA4335" d="M -14.754 43.989 C -12.984 43.989 -11.404 44.599 -10.154 45.789 L -6.734 42.369 C -8.804 40.429 -11.514 39.239 -14.754 39.239 C -19.444 39.239 -23.494 41.939 -25.464 45.859 L -21.484 48.949 C -20.534 46.099 -17.884 43.989 -14.754 43.989 Z"/>
                                </g>
                            </svg>
                            Sign up with Google
                        </button>
                    </div>
                    <div class="mt-5">
                        <p class="text-xs text-gray-500 text-center">
                            By signing up, you agree to our 
                            <a href="/pages/legal/terms.html" class="text-cyan-400 hover:text-cyan-300">Terms of Service</a> and 
                            <a href="/pages/legal/privacy.html" class="text-cyan-400 hover:text-cyan-300">Privacy Policy</a>.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div id="footer-container"></div>

    <!-- JavaScript -->
    <script>
        function togglePasswordVisibility(inputId) {
            const passwordInput = document.getElementById(inputId);
            const eyeIcon = event.currentTarget.querySelector('.password-eye-icon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeIcon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" />
                `;
            } else {
                passwordInput.type = 'password';
                eyeIcon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                `;
            }
        }
    </script>
    
    <script>
        // Make sure page is fully loaded before executing functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Load header and footer components
            loadComponent('header-container', '/components/header.html');
            loadComponent('footer-container', '/components/footer.html');
            
            // Initialize Supabase client directly with production credentials
            const supabaseUrl = 'https://txggovndoxdybdquopvx.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR4Z2dvdm5kb3hkeWJkcXVvcHZ4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDE1Nzg3MTMsImV4cCI6MjA1NzE1NDcxM30.p0l-YAdIjq-ICQNRGt5bN6YkrSB4NVDMaBUFYH4fpL4';
            
            // Configuration for redirects
            const siteUrl = window.location.origin;
            const redirectUrl = siteUrl + '/pages/login.html';
            const verifyRedirectUrl = siteUrl + '/pages/verify-success.html';
            
            // Make sure supabase is defined before creating the client
            if (typeof supabase === 'undefined' || typeof supabase.createClient === 'undefined') {
                console.error('Supabase is not defined properly. Check script loading order.');
                // Display an error message on the page 
                const errorMsg = document.createElement('div');
                errorMsg.className = 'p-4 text-center text-red-500 bg-red-100 rounded mt-4';
                errorMsg.innerHTML = 'Error loading Supabase client. Please refresh the page.';
                document.querySelector('.auth-options-container').prepend(errorMsg);
                return;
            }
            
            // Create Supabase client 
            try {
                const { createClient } = supabase;
                const supabaseClient = createClient(supabaseUrl, supabaseKey);
                
                // Make it available to other scripts on the page
                window.supabaseClient = supabaseClient;
            } catch (error) {
                console.error('Error creating Supabase client:', error);
            }
            
            // Add debug info box (can be removed in production)
            const debugDiv = document.createElement('div');
            debugDiv.className = 'p-4 my-4 bg-gray-800 rounded text-xs';
            debugDiv.innerHTML = `
                <h4 class="font-bold text-cyan-400 mb-2">Connection Information:</h4>
                <p>Supabase URL: <span class="text-white" id="supabase-url-display">${supabaseUrl}</span></p>
                <p>Site URL: <span class="text-white">${siteUrl}</span></p>
                <p>Redirect URL: <span class="text-white">${verifyRedirectUrl}</span></p>
            `;
            
            // Insert after the form
            const authOption = document.querySelector('#email-register');
            if (authOption) {
                authOption.appendChild(debugDiv);
            }
            
            // Handle tab switching
            const tabs = document.querySelectorAll('.auth-tab');
            const authOptions = document.querySelectorAll('.auth-option');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    // Remove active state from all tabs
                    tabs.forEach(t => {
                        t.classList.remove('text-cyan-400', 'border-b-2', 'border-cyan-400');
                        t.classList.add('text-gray-400');
                    });
                    
                    // Add active state to clicked tab
                    tab.classList.remove('text-gray-400');
                    tab.classList.add('text-cyan-400', 'border-b-2', 'border-cyan-400');
                    
                    // Hide all auth options
                    authOptions.forEach(option => {
                        option.classList.add('hidden');
                    });
                    
                    // Show selected auth option
                    const targetId = tab.id.split('-')[0] + '-register';
                    document.getElementById(targetId).classList.remove('hidden');
                });
            });
            
            // Handle form submission
            const registerForm = document.getElementById('register-form');
            registerForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const fullname = document.getElementById('fullname').value;
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirm-password').value;
                
                if (password !== confirmPassword) {
                    alert('Passwords do not match!');
                    return;
                }
                
                if (password.length < 8) {
                    alert('Password must be at least 8 characters long!');
                    return;
                }
                
                try {
                    // Show loading state
                    const submitButton = this.querySelector('button[type="submit"]');
                    const originalButtonText = submitButton.innerHTML;
                    submitButton.innerHTML = 'Creating account...';
                    submitButton.disabled = true;
                    
                    // Check if supabaseClient is available
                    if (!window.supabaseClient) {
                        throw new Error('Supabase client is not initialized. Please refresh the page and try again.');
                    }
                    
                    // Register user with Supabase
                    console.log('Attempting to register with Supabase...');
                    const { data, error } = await window.supabaseClient.auth.signUp({
                        email: email,
                        password: password,
                        options: {
                            data: {
                                full_name: fullname
                            },
                            emailRedirectTo: verifyRedirectUrl
                        }
                    });
                    
                    console.log('Supabase response:', data);
                    console.log('Email confirmation sent to:', email);
                    
                    if (error) {
                        console.error('Supabase registration error:', error);
                        throw error;
                    }
                    
                    // Hide the registration form
                    registerForm.classList.add('hidden');
                    
                    // Create and show the success message
                    const successMessage = document.createElement('div');
                    successMessage.className = 'text-center py-8';
                    successMessage.innerHTML = `
                        <svg class="mx-auto h-16 w-16 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <h3 class="mt-4 text-xl font-medium text-white">Check your email</h3>
                        <p class="mt-2 text-gray-400">We've sent a confirmation link to <strong>${email}</strong></p>
                        <p class="mt-1 text-gray-400">Please check your inbox and click the link to complete your registration.</p>
                        <p class="mt-6 text-gray-500">Didn't receive the email? Check your spam folder or <a href="#" id="resend-email" class="text-cyan-400 hover:text-cyan-300">click here to resend</a>.</p>
                    `;
                    
                    registerForm.parentNode.appendChild(successMessage);
                    
                    // Handle resend functionality
                    document.getElementById('resend-email').addEventListener('click', async function(e) {
                        e.preventDefault();
                        
                        try {
                            // Resend confirmation email
                            const { error } = await window.supabaseClient.auth.resend({
                                type: 'signup',
                                email: email,
                                options: {
                                    emailRedirectTo: verifyRedirectUrl
                                }
                            });
                            
                            if (error) throw error;
                            
                            alert('Confirmation email has been resent. Please check your inbox.');
                        } catch (error) {
                            console.error('Error resending confirmation email:', error);
                            alert('Failed to resend confirmation email: ' + error.message);
                        }
                    });
                    
                } catch (error) {
                    console.error('Registration error:', error);
                    
                    // Enhanced error display with more details
                    let errorMessage = 'Error creating account: ' + error.message;
                    
                    // Create detailed error div
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'mt-4 p-4 bg-red-900 bg-opacity-50 text-red-300 rounded text-sm';
                    errorDiv.innerHTML = `
                        <p class="font-bold">Error Details:</p>
                        <p>${error.message}</p>
                        <p class="mt-2 font-bold">Troubleshooting Steps:</p>
                        <ul class="list-disc ml-5">
                            <li>Check your email address and make sure it's valid</li>
                            <li>Make sure your password meets the requirements (at least 8 characters)</li>
                            <li>The email might already be registered</li>
                        </ul>
                    `;
                    
                    // Find message container or create one
                    let messageContainer = document.querySelector('.message-container');
                    if (!messageContainer) {
                        messageContainer = document.createElement('div');
                        messageContainer.className = 'message-container';
                        registerForm.prepend(messageContainer);
                    }
                    
                    messageContainer.innerHTML = '';
                    messageContainer.appendChild(errorDiv);
                    
                    alert('Error creating account: ' + error.message);
                    
                    // Reset button state
                    const submitButton = this.querySelector('button[type="submit"]');
                    submitButton.innerHTML = originalButtonText;
                    submitButton.disabled = false;
                }
            });
            
            // Developer buttons functionality
            const forceLocalSupabaseBtn = document.getElementById('force-local-supabase');
            if (forceLocalSupabaseBtn) {
                forceLocalSupabaseBtn.addEventListener('click', function() {
                    if (confirm('Force using local Supabase? This is for development only.')) {
                        localStorage.setItem('forceLocalDB', 'true');
                        localStorage.setItem('useProductionDB', 'false');
                        alert('Set to use local Supabase. Reloading page...');
                        location.reload();
                    }
                });
            }
            
            const forceProdSupabaseBtn = document.getElementById('force-prod-supabase');
            if (forceProdSupabaseBtn) {
                forceProdSupabaseBtn.addEventListener('click', function() {
                    if (confirm('Force using production Supabase?')) {
                        localStorage.setItem('forceLocalDB', 'false');
                        localStorage.setItem('useProductionDB', 'true');
                        alert('Set to use production Supabase. Reloading page...');
                        location.reload();
                    }
                });
            }
            
            const resetSupabaseDetectionBtn = document.getElementById('reset-supabase-detection');
            if (resetSupabaseDetectionBtn) {
                resetSupabaseDetectionBtn.addEventListener('click', function() {
                    localStorage.removeItem('forceLocalDB');
                    localStorage.removeItem('useProductionDB');
                    alert('Reset to automatic Supabase detection. Reloading page...');
                    location.reload();
                });
            }
            
            // Test email button
            const testEmailBtn = document.getElementById('test-email-btn');
            if (testEmailBtn) {
                testEmailBtn.addEventListener('click', function() {
                    const email = document.getElementById('email').value;
                    if (!email) {
                        alert('Please enter an email address first');
                        return;
                    }
                    
                    alert(`This would test email delivery to: ${email}\nThis feature is for development purposes only.`);
                });
            }
            
            // Tab switching
            const emailTab = document.getElementById('email-tab');
            const googleTab = document.getElementById('google-tab');
            const emailForm = document.getElementById('email-register');
            const googleForm = document.getElementById('google-register');
            
            // Initial visibility setup
            emailForm.classList.remove('hidden');
            googleForm.classList.add('hidden');
            
            // Set up tab click handlers
            emailTab.addEventListener('click', function() {
                // Update tab appearance
                emailTab.classList.add('text-cyan-400', 'border-b-2', 'border-cyan-400');
                emailTab.classList.remove('text-gray-400');
                googleTab.classList.remove('text-cyan-400', 'border-b-2', 'border-cyan-400');
                googleTab.classList.add('text-gray-400');
                
                // Show/hide forms
                emailForm.classList.remove('hidden');
                googleForm.classList.add('hidden');
            });
            
            googleTab.addEventListener('click', function() {
                // Update tab appearance
                googleTab.classList.add('text-cyan-400', 'border-b-2', 'border-cyan-400');
                googleTab.classList.remove('text-gray-400');
                emailTab.classList.remove('text-cyan-400', 'border-b-2', 'border-cyan-400');
                emailTab.classList.add('text-gray-400');
                
                // Show/hide forms
                emailForm.classList.add('hidden');
                googleForm.classList.remove('hidden');
            });
            
            // Initialize Supabase
            initializeSupabase();
        });
        
        // Function to initialize Supabase
        async function initializeSupabase() {
            // Try to load Supabase if not already loaded
            try {
                if (typeof supabase === 'undefined') {
                    await loadScript('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2');
                }
                
                if (typeof window.SupabaseConfig === 'undefined') {
                    await loadScript('/js/supabase-config.js');
                }
                
                if (typeof window.SupabaseClient === 'undefined') {
                    await loadScript('/js/supabase-client.js');
                }
                
                // Initialize form handlers after Supabase is loaded
                initRegistrationFormHandlers();
            } catch (error) {
                console.error('Failed to load Supabase dependencies:', error);
                showMessage('error', 'Failed to load authentication system. Please refresh the page.');
            }
        }
        
        // Helper function to load scripts dynamically
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = () => reject(new Error(`Failed to load script: ${src}`));
                document.head.appendChild(script);
            });
        }
        
        // Google sign-up function
        async function signUpWithGoogle() {
            try {
                console.log('Google sign-up clicked');
                
                // Show loading indicator
                const messageElement = document.getElementById('message-container');
                messageElement.innerText = 'Connecting to Google...';
                messageElement.className = 'mt-4 p-3 rounded text-center bg-blue-900 bg-opacity-50 text-blue-200';
                messageElement.classList.remove('hidden');
                
                // Get Supabase client
                const supabaseClient = await initializeSupabase();
                
                if (!supabaseClient) {
                    throw new Error('Authentication system not available');
                }
                
                // Get the proper redirect URL from SupabaseConfig if available
                let redirectUrl;
                if (window.SupabaseConfig && window.SupabaseConfig.googleAuthRedirectUri) {
                    redirectUrl = window.SupabaseConfig.googleAuthRedirectUri;
                } else {
                    // Fallback to the default Supabase callback URL
                    redirectUrl = "https://txggovndoxdybdquopvx.supabase.co/auth/v1/callback?flowName=GeneralOAuthFlow";
                }
                
                console.log('Initiating Google sign-up with redirect URL:', redirectUrl);
                
                // Call Supabase OAuth for Google
                const { data, error } = await supabaseClient.auth.signInWithOAuth({
                    provider: 'google',
                    options: {
                        redirectTo: redirectUrl
                    }
                });
                
                console.log('OAuth response:', data || 'No data', error || 'No error');
                
                if (error) {
                    throw error;
                }
                
                // If successful, the user will be redirected to Google's auth page
                console.log('Google signup initiated successfully');
            } catch (error) {
                console.error('Error with Google sign-up:', error);
                const messageElement = document.getElementById('message-container');
                messageElement.innerText = `Failed to connect to Google: ${error.message}`;
                messageElement.className = 'mt-4 p-3 rounded text-center bg-red-900 bg-opacity-50 text-red-200';
            }
        }
        
        // Helper function to create message container if it doesn't exist
        function createMessageContainer() {
            const container = document.createElement('div');
            container.id = 'message-container';
            container.className = 'mb-4 p-3 rounded text-center';
            
            // Find the auth options container and insert at the top
            const authContainer = document.querySelector('.auth-options-container');
            if (authContainer) {
                authContainer.prepend(container);
            }
            
            return container;
        }
        
        // Function to show messages
        function showMessage(type, message) {
            // Create message container if it doesn't exist
            let messageContainer = document.getElementById('message-container');
            if (!messageContainer) {
                messageContainer = document.createElement('div');
                messageContainer.id = 'message-container';
                messageContainer.className = 'mb-4 p-3 rounded text-center';
                document.querySelector('.auth-options-container').prepend(messageContainer);
            }
            
            // Set message style based on type
            messageContainer.className = 'mb-4 p-3 rounded text-center';
            
            switch (type) {
                case 'error':
                    messageContainer.className += ' bg-red-900 bg-opacity-50 text-red-200';
                    break;
                case 'success':
                    messageContainer.className += ' bg-green-900 bg-opacity-50 text-green-200';
                    break;
                case 'info':
                    messageContainer.className += ' bg-blue-900 bg-opacity-50 text-blue-200';
                    break;
                default:
                    messageContainer.className += ' bg-gray-800 text-gray-200';
            }
            
            messageContainer.textContent = message;
            messageContainer.style.display = 'block';
        }
    </script>
</body>
</html>

